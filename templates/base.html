{# TODO: Avoid flashing blue header when loading pages in simulation mode.
   The header shows blue briefly before checkSimulationMode() runs and adds
   the simulation-mode class. Consider: server-side detection of simulation mode
   and passing it to templates, or CSS that defaults to simulation mode colors. #}
<!DOCTYPE html>
<html>
<head>
    <title>{% block title %}SMS Dashboard{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script>
        // Global simulation mode state
        window.simulationMode = false;

        async function checkSimulationMode() {
            try {
                const res = await fetch('/api/config');
                const data = await res.json();
                window.simulationMode = data.simulationMode;

                if (data.simulationMode) {
                    // Add simulation banner
                    const banner = document.createElement('div');
                    banner.className = 'simulation-banner';
                    banner.innerHTML = 'SIMULATION MODE <span>No real SMS will be sent or received</span>';
                    document.body.insertBefore(banner, document.body.firstChild);

                    // Update header style
                    const header = document.querySelector('.header');
                    if (header) header.classList.add('simulation-mode');

                    // Show simulation-only elements
                    document.querySelectorAll('.simulation-only').forEach(el => {
                        el.classList.remove('hidden');
                    });
                } else {
                    // Hide simulation-only elements
                    document.querySelectorAll('.simulation-only').forEach(el => {
                        el.classList.add('hidden');
                    });
                }
            } catch (e) {
                console.error('Failed to check simulation mode:', e);
            }
        }

        document.addEventListener('DOMContentLoaded', checkSimulationMode);
    </script>
</head>
<body>
    {% block header %}
    <div class="header">
        <h1>SMS Messaging Dashboard</h1>
        <div class="nav">
            <a href="/" {% if active_page == 'dashboard' %}class="active"{% endif %}>Dashboard</a>
            <a href="/incoming" {% if active_page == 'incoming' %}class="active"{% endif %}>Incoming Messages</a>
            <a href="/outgoing" {% if active_page == 'outgoing' %}class="active"{% endif %}>Outgoing Messages</a>
            <a href="/send" {% if active_page == 'send' %}class="active"{% endif %}>Send Message</a>
            <a href="/users" {% if active_page == 'users' %}class="active"{% endif %}>Users</a>
            <a href="/simulate" class="simulation-only hidden{% if active_page == 'simulate' %} active{% endif %}">Simulate Incoming</a>
        </div>
        <a href="/logout" class="logout btn btn-secondary">Logout</a>
    </div>
    {% endblock %}
    {% block body %}{% endblock %}
</body>
</html>
